# Claude-Flow Architecture & Deployment Modes

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Claude Code CLI                           â”‚
â”‚                     (User Interface)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ MCP Protocol
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude-Flow Platform                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Intelligence Layer                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚ RuVector   â”‚  â”‚ Q-Learning â”‚  â”‚  Pattern   â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  Store     â”‚  â”‚   Router   â”‚  â”‚  Learning  â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Agent Layer                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Flutter  â”‚ â”‚ Firebase â”‚ â”‚   Test   â”‚ â”‚ Security â”‚   â”‚  â”‚
â”‚  â”‚  â”‚Specialistâ”‚ â”‚Specialistâ”‚ â”‚Specialistâ”‚ â”‚Specialistâ”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚  â”‚
â”‚  â”‚  â”‚Architect â”‚                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 Coordination Layer                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚    Raft      â”‚  â”‚  Byzantine   â”‚  â”‚    Gossip    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Consensus   â”‚  â”‚  Consensus   â”‚  â”‚  Consensus   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Swarm Layer                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚  â”‚  Feature Team    â”‚  â”‚ Review Committee â”‚             â”‚  â”‚
â”‚  â”‚  â”‚  (Hierarchical)  â”‚  â”‚  (Peer-to-Peer)  â”‚             â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Project APIs
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HexBuzz Project                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Flutter App  â”‚  â”‚   Firebase   â”‚  â”‚    Tests     â”‚          â”‚
â”‚  â”‚    (lib/)    â”‚  â”‚  (functions/)â”‚  â”‚   (test/)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Modes

### Mode 1: MCP Server (Project-Specific) â­ RECOMMENDED

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Code Process                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              User Interaction                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚ spawns                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          MCP Server (claude-flow)                  â”‚  â”‚
â”‚  â”‚  â€¢ Loads: /project/.claude-flow/                   â”‚  â”‚
â”‚  â”‚  â€¢ Agents: 5 specialists                           â”‚  â”‚
â”‚  â”‚  â€¢ Vector Store: project-specific                  â”‚  â”‚
â”‚  â”‚  â€¢ Lifecycle: tied to Claude Code                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Characteristics:
  âœ“ Auto-start/stop with Claude Code
  âœ“ Project config in .claude-flow/
  âœ“ Memory: ~100MB when active
  âœ“ Latency: Low (in-process)
  âœ“ Management: Zero (automatic)
```

---

### Mode 2: PM2 Service (System-Wide)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   System (Linux/Mac/Windows)             â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 PM2 Process Manager               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚      claude-flow daemon (port 3000)        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Config: ~/.claude-flow/ or project      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Agents: 5 specialists                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Vector Store: can be shared             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Lifecycle: always running               â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â–²                                   â”‚
â”‚                       â”‚ HTTP/WebSocket                    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚        â”‚                              â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Claude Code â”‚              â”‚  CLI Tool   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Characteristics:
  âœ“ Always running (daemon)
  âœ“ Serves multiple projects
  âœ“ Memory: ~150MB constant
  âœ“ Latency: Very low (warm)
  âœ“ Management: PM2 commands
```

---

### Mode 3: systemd Service (System-Wide)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Linux System                           â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                systemd (PID 1)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚   claude-flow.service (port 3000)          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Config: project or global               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Agents: 5 specialists                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Vector Store: configurable              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Lifecycle: boot to shutdown             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Logging: journald                       â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â–²                                   â”‚
â”‚                       â”‚ HTTP/WebSocket                    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚        â”‚                              â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Claude Code â”‚              â”‚  CLI Tool   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Characteristics:
  âœ“ Native Linux integration
  âœ“ Starts on boot
  âœ“ Memory: ~150MB constant
  âœ“ Latency: Very low (warm)
  âœ“ Management: systemctl
```

---

### Mode 4: On-Demand CLI (No Daemon)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Terminal / CI System                  â”‚
â”‚                                                           â”‚
â”‚  $ npx claude-flow@v3alpha --agent architect --task "..." â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Spawns temporary claude-flow process           â”‚   â”‚
â”‚  â”‚  â€¢ Loads config from project                     â”‚   â”‚
â”‚  â”‚  â€¢ Creates agents for this task                  â”‚   â”‚
â”‚  â”‚  â€¢ Executes task                                 â”‚   â”‚
â”‚  â”‚  â€¢ Exits when done                               â”‚   â”‚
â”‚  â”‚  â€¢ No persistent state                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Characteristics:
  âœ“ No daemon needed
  âœ“ Memory: Only during execution
  âœ“ Latency: High (cold start ~2-5s)
  âœ“ Management: None
  âœ“ Best for: CI/CD, scripts
```

---

## ğŸ”„ Data Flow Diagrams

### MCP Server Request Flow

```
User in Claude Code
      â”‚
      â”‚ "Use architect to review code"
      â”‚
      â–¼
Claude Code Parser
      â”‚
      â”‚ Identifies: agent=architect, task=review
      â”‚
      â–¼
MCP Protocol Handler
      â”‚
      â”‚ Sends request to MCP server
      â”‚
      â–¼
Claude-Flow MCP Server
      â”‚
      â”œâ”€â”€â–¶ Load project config (.claude-flow/)
      â”‚
      â”œâ”€â”€â–¶ Query RuVector (find similar patterns)
      â”‚
      â”œâ”€â”€â–¶ Q-Learning Router (select agent)
      â”‚
      â–¼
Architect Agent
      â”‚
      â”œâ”€â”€â–¶ Read project files
      â”‚
      â”œâ”€â”€â–¶ Analyze SOLID compliance
      â”‚
      â”œâ”€â”€â–¶ Check code metrics
      â”‚
      â–¼
Generate Response
      â”‚
      â”‚ Store patterns in RuVector
      â”‚
      â–¼
Return to Claude Code
      â”‚
      â–¼
Display to User
```

---

### Workflow Execution Flow

```
User Request: "Use feature development workflow"
      â”‚
      â–¼
Claude-Flow Workflow Engine
      â”‚
      â”œâ”€â”€â–¶ Load workflow YAML
      â”‚    (workflows/feature_development.yaml)
      â”‚
      â–¼
Phase 1: Planning
      â”‚
      â”œâ”€â”€â–¶ Spawn Architect agent
      â”‚
      â”œâ”€â”€â–¶ Architect analyzes & plans
      â”‚
      â”œâ”€â”€â–¶ Store plan in context
      â”‚
      â–¼
Phase 2: Implementation (Swarm)
      â”‚
      â”œâ”€â”€â–¶ Spawn Feature Team Swarm
      â”‚    â”œâ”€â”€ Queen: Architect
      â”‚    â”œâ”€â”€ Worker: Flutter Specialist
      â”‚    â””â”€â”€ Worker: Firebase Specialist
      â”‚
      â”œâ”€â”€â–¶ Raft Consensus Algorithm
      â”‚    â”œâ”€â”€ Leader election (Architect)
      â”‚    â”œâ”€â”€ Task distribution
      â”‚    â””â”€â”€ Collect results
      â”‚
      â”œâ”€â”€â–¶ Workers implement in parallel
      â”‚
      â”œâ”€â”€â–¶ Reach consensus on approach
      â”‚
      â–¼
Phase 3: Testing (Parallel to Security)
      â”‚
      â”œâ”€â”€â–¶ Test Specialist writes tests
      â”‚
      â””â”€â”€â–¶ Security Specialist scans code
      â”‚
      â”œâ”€â”€â–¶ Both complete independently
      â”‚
      â–¼
Phase 4: Review
      â”‚
      â”œâ”€â”€â–¶ Architect final review
      â”‚
      â”œâ”€â”€â–¶ Check all quality gates
      â”‚
      â–¼
Success / Rejection
      â”‚
      â”œâ”€â”€â–¶ Store patterns (if success)
      â”‚
      â””â”€â”€â–¶ Return result to user
```

---

### Consensus Algorithm Flow (Raft)

```
Feature Team Swarm (Hierarchical)

         Architect (Queen/Leader)
              â”‚
              â”‚ Coordinates
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼
Flutter   Firebase   Test
Worker    Worker    Worker
    â”‚         â”‚         â”‚
    â”‚ Implement tasks   â”‚
    â”‚         â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Submit results
              â”‚
              â–¼
         Architect Reviews
              â”‚
         â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
         â”‚    â”‚    â”‚
    Accept Reject Discuss
         â”‚    â”‚    â”‚
         â”‚    â”‚    â””â”€â”€â–¶ Another round
         â”‚    â”‚
         â”‚    â””â”€â”€â–¶ Request changes
         â”‚
         â””â”€â”€â–¶ Consensus reached
```

---

### Consensus Algorithm Flow (Byzantine)

```
Review Committee Swarm (Peer-to-Peer)

All agents review independently:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Architect  â”‚  â”‚  Flutter   â”‚  â”‚  Firebase  â”‚
â”‚  (vote:2x) â”‚  â”‚  (vote:1x) â”‚  â”‚  (vote:1x) â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚               â”‚
      â”‚  Independent review phase     â”‚
      â”‚  (no communication)           â”‚
      â”‚               â”‚               â”‚
      â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security   â”‚  â”‚    Test    â”‚  â”‚            â”‚
â”‚ (vote:1.5x)â”‚  â”‚  (vote:1x) â”‚  â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Collect votes
              â”‚
              â–¼
      Aggregation Engine
              â”‚
              â”œâ”€â”€â–¶ Weight votes
              â”‚    (Architect: 2x, Security: 1.5x)
              â”‚
              â”œâ”€â”€â–¶ Calculate agreement %
              â”‚    (need â‰¥70% for approval)
              â”‚
              â”œâ”€â”€â–¶ Check for vetos
              â”‚    (Architect or Security can veto)
              â”‚
              â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Consensus Result  â”‚
      â”‚ â€¢ Approved: 85%   â”‚
      â”‚ â€¢ No vetos        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ State & Storage

### Project-Specific Storage

```
/home/rmondo/repos/hex_buzz/
â””â”€â”€ .claude-flow/
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ claude-flow.yaml      # Main configuration
    â”œâ”€â”€ agents/
    â”‚   â”œâ”€â”€ flutter_specialist.yaml
    â”‚   â”œâ”€â”€ firebase_specialist.yaml
    â”‚   â”œâ”€â”€ test_specialist.yaml
    â”‚   â”œâ”€â”€ security_specialist.yaml
    â”‚   â””â”€â”€ architect.yaml
    â”œâ”€â”€ workflows/
    â”‚   â”œâ”€â”€ feature_development.yaml
    â”‚   â”œâ”€â”€ bug_fix.yaml
    â”‚   â””â”€â”€ code_review.yaml
    â”œâ”€â”€ domains/
    â”‚   â”œâ”€â”€ flutter_app.yaml
    â”‚   â”œâ”€â”€ firebase_backend.yaml
    â”‚   â””â”€â”€ testing.yaml
    â”œâ”€â”€ swarms/
    â”‚   â”œâ”€â”€ feature_team.yaml
    â”‚   â””â”€â”€ review_committee.yaml
    â”œâ”€â”€ vector_store/           # RuVector knowledge base
    â”‚   â”œâ”€â”€ index.hnsw          # HNSW index
    â”‚   â”œâ”€â”€ vectors.bin         # Vector embeddings
    â”‚   â””â”€â”€ metadata.json       # Pattern metadata
    â””â”€â”€ logs/
        â””â”€â”€ claude-flow.log     # Structured JSON logs
```

### System-Wide Storage (Optional)

```
~/.claude-flow/
â”œâ”€â”€ config.yaml                # Global configuration
â”œâ”€â”€ vector_store/              # Shared knowledge
â”‚   â””â”€â”€ (same structure as project)
â””â”€â”€ logs/
    â””â”€â”€ claude-flow.log
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Security Layers                         â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Input Validation Layer                    â”‚   â”‚
â”‚  â”‚  â€¢ AI Defence (injection prevention)             â”‚   â”‚
â”‚  â”‚  â€¢ Path traversal blocking                       â”‚   â”‚
â”‚  â”‚  â€¢ Sanitize all user inputs                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Access Control Layer                      â”‚   â”‚
â”‚  â”‚  â€¢ Restricted paths (.env, *.key, secrets/)      â”‚   â”‚
â”‚  â”‚  â€¢ Allowed operations (read, write, test, git)   â”‚   â”‚
â”‚  â”‚  â€¢ No arbitrary code execution                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Agent Security Layer                      â”‚   â”‚
â”‚  â”‚  â€¢ Security Specialist agent reviews all code    â”‚   â”‚
â”‚  â”‚  â€¢ OWASP Top 10 checking                         â”‚   â”‚
â”‚  â”‚  â€¢ Dependency vulnerability scanning             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Logging & Audit Layer                     â”‚   â”‚
â”‚  â”‚  â€¢ Structured JSON logs                          â”‚   â”‚
â”‚  â”‚  â€¢ No PII/secrets in logs                        â”‚   â”‚
â”‚  â”‚  â€¢ Audit trail of all agent actions             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance Characteristics

| Metric | MCP Server | PM2 Service | systemd | On-Demand |
|--------|-----------|-------------|---------|-----------|
| **Cold Start** | 500ms | N/A (always warm) | N/A | 2-5s |
| **Warm Request** | 50-100ms | 50-100ms | 50-100ms | N/A |
| **Memory (Idle)** | 0MB (not running) | ~150MB | ~150MB | 0MB |
| **Memory (Active)** | ~100MB | ~150MB | ~150MB | ~200MB |
| **CPU (Idle)** | 0% | 0.1-0.5% | 0.1-0.5% | 0% |
| **CPU (Active)** | 20-40% | 20-40% | 20-40% | 30-50% |
| **Disk I/O** | Low | Low | Low | Medium |
| **Network** | Loopback only | Loopback/TCP | Loopback/TCP | N/A |

---

## ğŸ¯ Decision Tree

```
                    Need claude-flow?
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                  Yes          No
                    â”‚            â””â”€â–¶ Skip setup
                    â”‚
              Single project?
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         Yes                  No
          â”‚                    â”‚
    Use Claude Code?     Multiple projects?
          â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   Yes         No        Yes      Server?
    â”‚           â”‚         â”‚          â”‚
    â”‚    Need daemon?     â”‚        â”Œâ”€â”´â”€â”
    â”‚      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”‚       Yes  No
    â”‚     Yes       No    â”‚        â”‚    â”‚
    â”‚      â”‚         â”‚    â”‚    systemd PM2
    â”‚      â”‚         â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚      â”‚              â”‚
    â–¼      â–¼              â–¼
  MCP    PM2/           PM2
Server  systemd       Service
  â­
```

**Legend**:
- â­ = Recommended for most users
- MCP Server = Best for single project + Claude Code
- PM2 Service = Best for multi-project dev
- systemd = Best for production servers
- On-Demand = Best for CI/CD

---

## ğŸ“ Quick Reference

### MCP Server Commands
```bash
npm run mcp:install   # Install
claude mcp list       # List servers
npm run mcp:remove    # Remove
```

### PM2 Service Commands
```bash
pm2 start claude-flow      # Start
pm2 status claude-flow     # Status
pm2 restart claude-flow    # Restart
pm2 stop claude-flow       # Stop
pm2 logs claude-flow       # Logs
pm2 monit                  # Monitor
```

### systemd Service Commands
```bash
sudo systemctl start claude-flow     # Start
sudo systemctl status claude-flow    # Status
sudo systemctl restart claude-flow   # Restart
sudo systemctl stop claude-flow      # Stop
sudo journalctl -u claude-flow -f    # Logs
```

### Health Check (All Modes)
```bash
curl http://localhost:3000/health
npm run daemon:status
npm run health
```

---

For detailed setup instructions, see:
- [DAEMON_QUICKSTART.md](DAEMON_QUICKSTART.md) - Quick start guide
- [DAEMON_SETUP.md](DAEMON_SETUP.md) - Comprehensive setup
- [README.md](README.md) - Full documentation
